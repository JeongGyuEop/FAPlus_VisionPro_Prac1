using System;
using System.Windows.Forms;
using Cognex.VisionPro; // VisionPro 기본 네임스페이스
using Cognex.VisionPro.Exceptions; // VisionPro 예외 처리용 네임스페이스

namespace FrameGrabberList
{
    public partial class Form1 : Form
    {
        private Label label1;
        private ComboBox comboBox1;

        public Form1()
        {
            InitializeComponent();
        }

        // 폼 로드 시 프레임그래버 목록을 불러옴
        private void Form1_Load(object sender, EventArgs e)
        {
            try
            {
                InitializeAcquisition(); // 프레임그래버 리스트 초기화
            }
            catch (CogException ex)
            {
                MessageBox.Show(ex.Message);
                Application.Exit();
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
                Application.Exit();
            }
        }

        // 프레임그래버 연결 해제 포함 Dispose
        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if (components != null)
                    components.Dispose();

                // 모든 연결된 프레임그래버 연결 해제
                CogFrameGrabbers frameGrabbers = new CogFrameGrabbers();
                foreach (ICogFrameGrabber fg in frameGrabbers)
                {
                    fg.Disconnect(false);
                }
            }
            base.Dispose(disposing);
        }

        private System.ComponentModel.IContainer components = null;

        private void InitializeComponent()
        {
            this.label1 = new Label();
            this.comboBox1 = new ComboBox();

            // 
            // label1
            // 
            this.label1.Location = new System.Drawing.Point(40, 24);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(136, 24);
            this.label1.Text = "Frame Grabber Names:";

            // 
            // comboBox1
            // 
            this.comboBox1.Location = new System.Drawing.Point(32, 80);
            this.comboBox1.Name = "comboBox1";
            this.comboBox1.Size = new System.Drawing.Size(216, 21);

            // 
            // Form1
            // 
            this.ClientSize = new System.Drawing.Size(312, 158);
            this.Controls.Add(this.label1);
            this.Controls.Add(this.comboBox1);
            this.Name = "Form1";
            this.Text = "Lists names of all the frame grabbers installed in a system";
            this.Load += new EventHandler(this.Form1_Load);
        }

        /// <summary>
        /// 시스템에 연결된 프레임그래버들을 검색하고 콤보박스에 이름을 추가하는 함수
        /// </summary>
        private void InitializeAcquisition()
        {
            // Step 1 - 프레임그래버 리스트 생성
            CogFrameGrabbers fgList = new CogFrameGrabbers();

            if (fgList == null)
                throw new Exception("Failed to create the CogFrameGrabbers object.");

            // Step 2 - 프레임그래버가 존재하면 이름을 콤보박스에 추가
            if (fgList.Count > 0)
            {
                foreach (ICogFrameGrabber fg in fgList)
                {
                    comboBox1.Items.Add(fg.Name);
                }
            }
            else
            {
                comboBox1.Items.Add("No Frame Grabbers");
            }

            comboBox1.SelectedIndex = 0;
        }
    }
}
